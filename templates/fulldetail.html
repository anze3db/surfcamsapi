{% extends "layout.html" %}
{% load static %}
{% block content %}
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <video style="display: block;
                  margin-left: auto;
                  margin-right: auto"
           id="video"
           muted
           autoplay
           playsinline>
    </video>
    <main class="container">
        <script>
  var video = document.getElementById('video');
  window.addEventListener('resize', function (event) {
      video.setAttribute('width', document.body.clientWidth - 15);
      video.setAttribute('height', window.innerHeight);
  });
  video.setAttribute('width', document.body.clientWidth - 15);
  video.setAttribute('height', window.innerHeight);
  var videoSrc = '{{ cam.url }}';
  if (Hls.isSupported()) {
    var hls = new Hls();
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
    hls.on(Hls.Events.ERROR, function (event, data) {
        console.log("error", event, data)
});
  }
  // HLS.js is not supported on platforms that do not have Media Source
  // Extensions (MSE) enabled.
  //
  // When the browser has built-in HLS support (check using `canPlayType`),
  // we can provide an HLS manifest (i.e. .m3u8 URL) directly to the video
  // element through the `src` property. This is using the built-in support
  // of the plain video element, without using HLS.js.
  //
  // Note: it would be more normal to wait on the 'canplay' event below however
  // on Safari (where you are most likely to find built-in HLS support) the
  // video.src URL must be on the user-driven white-list before a 'canplay'
  // event will be emitted; the last video event that can be reliably
  // listened-for when the URL is not on the white-list is 'loadedmetadata'.
  else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = videoSrc;
  }
  else {
    console.warn('Your browser does not support MSE');
  }
        </script>
        <main class="container">
            <h1>{{ cam.title }}</h1>
            <div class="grid">
                <div>
                    <table>
                        {% for tide in tides %}
                            <tr>
                                <td>
                                    {% if tide.type == "HIGH" %}
                                        ▲
                                    {% else %}
                                        ▼
                                    {% endif %}
                                    {{ tide.type | title }}
                                </td>
                                <td>{{ tide.date | date:"H:i" }}</td>
                                <td style="text-align: right;">{{ tide.height }}</td>
                            </tr>
                        {% endfor %}
                    </table>
                </div>
                <div>
                    <table>
                        {% for sun in sunlight %}
                            <tr>
                                <td>{{ sun.type | title }}</td>
                                <td style="text-align: right;">{{ sun.date | date:"H:i" }}</td>
                            </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
            <div>
                <table>
                    {% for wind, wave in wind_and_waves %}
                        <tr>
                            {% if wind.break %}
                                <td colspan="7">{{ wind.date | date:"l, M j" }}</td>
                            {% else %}
                                <td style="padding:  0px 0px;
                                           width: 12px;
                                           transform: rotate(-90deg);
                                           font-size: 10px">{{ wind.date | date:"H:i" }}</td>
                                <td style="padding: 10px 8px;
                                           font-size: 12px;
                                           text-align: center;
                                           background-color: #58B0E1;
                                           color: white">
                                    {{ wave.min|floatformat:"1" }}-{{ wave.max| floatformat:"1" }}m
                                </td>
                                <td style="padding: 10px 8px; line-height: 12px;">
                                    <span style="font-size: 12px;"><strong>{{ wave.primary_swell_size | floatformat:"1" }}</strong>m
                                    </td>
                                    <td style="padding: 10px 8px; font-size: 12px;">
                                        <strong>{{ wave.primary_swell_period }}</strong>s</span>
                                </td>
                                <td style="padding: 10px 8px; text-align: center; line-height: 18px;">
                                    <div style="transform: rotate(calc({{ wave.primary_swell_direction | floatformat:"0" }}deg - 270deg))">➤</div>
                                    <span style="font-size:10px;">{{ wave.primary_swell_direction | floatformat:"0" }}°</span>
                                </td>
                                <td style="padding: 10px 8px;">
                                    <div style="float: left; font-size: 12px; font-weight: bold;">{{ wind.speed|floatformat:"0" }}</div>
                                    <div style="padding: 0px 0px 0px 4px;
                                                float: left;
                                                font-size:8px;
                                                line-height: 8px">
                                        {{ wind.gust|floatformat:"0" }}
                                        <br>
                                        kph
                                    </div>
                                </td>
                                <td style="padding: 10px 8px;
                                           background-color: #55AB68;
                                           color: white;
                                           text-align: center;
                                           line-height: 12px">
                                    <div style="transform: rotate(calc({{ wind.direction | floatformat:"0" }}deg - 270deg))">➤</div>
                                    <span style="font-size: 10px">{{ wind.direction_type | title }}
                                        </style>
                                    </td>
                                    <!-- D8833B -->
                                {% endif %}
                            </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
        </main>
    {% endblock content %}
